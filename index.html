<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LiftLog ‚Äî Simple, Private Workout Tracker</title>
  <link rel="stylesheet" href="./style.css" />
  <!-- Chart.js (no Recharts) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" defer></script>

  <!-- LiftLog modular JS (order matters) -->
  <script src="./app.core.js" defer></script>       <!-- storage, utils, nav, settings -->
  <script src="./app.workouts.js" defer></script>   <!-- workout form, history, badges -->
  <script src="./app.metrics.js" defer></script>    <!-- metrics + BF estimators + BMR -->
  <script src="./app.analytics.js" defer></script>  <!-- charts + projections -->
  <script src="./app.phase2.js" defer></script>     <!-- coach, readiness, goals, community, reminders -->
  <script src="./app.main.js" defer></script>       <!-- bootstraps initial render -->
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <span class="logo">üèãÔ∏è</span>
      <h1>LiftLog</h1>
    </div>
    <nav class="tabs" role="tablist" aria-label="Main">
      <button class="tab active" data-tab="dashboard" aria-selected="true">Dashboard</button>
      <button class="tab" data-tab="workout">Log Workout</button>
      <button class="tab" data-tab="metrics">Body Metrics</button>
      <button class="tab" data-tab="calories">Calories</button>
      <button class="tab" data-tab="coach">Coach</button>
      <button class="tab" data-tab="goals">Goals</button>
      <button class="tab" data-tab="community">Community</button>
      <button class="tab" data-tab="templates">Templates</button>
      <button class="tab" data-tab="settings">Settings</button>
    </nav>
  </header>

  <main>
    <!-- DASHBOARD -->
    <section id="dashboard" class="panel active">
      <div class="grid">
        <section class="card">
          <header class="card-head">
            <h2>Today</h2>
            <div class="meta" id="todayMeta"></div>
          </header>
          <div class="card-body" id="todaySummary">
            <p>No workout logged yet.</p>
            <button class="btn primary" id="goLog">Log a workout</button>
          </div>
        </section>

        <section class="card">
          <header class="card-head">
            <h3>Streak & Badges</h3>
          </header>
          <div class="card-body">
            <div id="streakBox" class="streak">üî• 0-day streak</div>
            <div id="badges" class="badges"></div>
          </div>
        </section>

        <!-- NEW: Mini Goals widget -->
        <section class="card">
          <header class="card-head">
            <h3>Goals ‚Äî Snapshot</h3>
          </header>
          <div class="card-body" id="miniGoalsBox">
            <p class="muted">Set goals in the Goals tab to see progress here.</p>
          </div>
        </section>

        <section class="card stretch">
          <header class="card-head">
            <h3>Total Volume / Week</h3>
          </header>
          <div class="card-body"><canvas id="chartVolume"></canvas></div>
        </section>

        <section class="card">
          <header class="card-head">
            <h3>1RM Estimates</h3>
            <small class="muted">1RM = One-Rep Max (heaviest weight you can lift once, estimated).</small>
          </header>
          <div class="card-body"><canvas id="chart1RM"></canvas></div>
        </section>

        <section class="card">
          <header class="card-head">
            <h3>Body Weight & Body Fat %</h3>
            <small class="muted">Weight in lb; body fat in %.</small>
          </header>
          <div class="card-body"><canvas id="chartBody"></canvas></div>
        </section>

        <section class="card stretch">
          <header class="card-head">
            <h3>PR History</h3>
            <small class="muted">PR = Personal Record (your best/heaviest set per exercise).</small>
          </header>
          <div class="card-body"><canvas id="chartPR"></canvas></div>
        </section>
      </div>
    </section>

    <!-- WORKOUT LOG -->
    <section id="workout" class="panel">
      <form id="workoutForm" class="card">
        <header class="card-head">
          <h2>Log Workout</h2>
          <div class="row">
            <label>Date <input type="date" id="wDate" required></label>
            <label>Title <input type="text" id="wTitle" placeholder="Upper A, Push, Legs..." required></label>
            <label>Notes <input type="text" id="wNotes" placeholder="Feeling good, PR on bench..."></label>
          </div>
        </header>
        <div class="card-body">
          <div id="sets"></div>
          <div class="row">
            <button type="button" class="btn" id="addSet">+ Add Set</button>
            <button type="button" class="btn" id="addSuperset">+ Add Superset</button>
            <div class="spacer"></div>
            <button type="submit" class="btn primary">Save Workout</button>
          </div>
        </div>
      </form>

      <section class="card">
        <header class="card-head">
          <h3>History</h3>
          <div class="row">
            <input id="historySearch" placeholder="Search exercise or note...">
            <button class="btn" id="exportData">Export JSON</button>
            <button class="btn warn" id="clearAll">Clear All Data</button>
          </div>
        </header>
        <div class="card-body" id="historyList"></div>
      </section>
    </section>

    <!-- BODY METRICS -->
    <section id="metrics" class="panel">
      <form id="metricsForm" class="card">
        <header class="card-head"><h2>Body Metrics</h2></header>
        <div class="card-body">
          <div class="grid2">
            <label>Height ‚Äî Feet <input type="number" step="1" id="mHeightFt" placeholder="e.g., 5"></label>
            <label>Height ‚Äî Inches <input type="number" step="0.1" id="mHeightIn" placeholder="e.g., 10"></label>
            <label>Weight (lb) <input type="number" step="0.1" id="mWeightLb" placeholder="e.g., 175.0"></label>
            <label>Body Fat % (optional) <input type="number" step="0.1" id="mBodyFat" placeholder="e.g., 18"></label>
            <label>Waist (in, optional) <input type="number" step="0.1" id="mWaist"></label>
            <label>Hip (in, optional) <input type="number" step="0.1" id="mHip"></label>
            <label>Chest (in, optional) <input type="number" step="0.1" id="mChest"></label>
            <label>Neck (in, optional) <input type="number" step="0.1" id="mNeck"></label>
            <!-- Scale-assisted fields -->
            <label>Lean Body Mass (lb) <input type="number" step="0.1" id="mLBMlb"></label>
            <label>Body Water % <input type="number" step="0.1" id="mWaterPct"></label>
            <label>Muscle Mass % <input type="number" step="0.1" id="mMusclePct"></label>
            <label>Bone Mass (lb) <input type="number" step="0.1" id="mBoneLb"></label>
            <label>Protein % <input type="number" step="0.1" id="mProteinPct"></label>
            <label>Visceral Fat Index <input type="number" step="0.1" id="mVisceral"></label>
            <label>Resting HR (bpm) <input type="number" step="1" id="mRHR"></label>
            <label>Date <input type="date" id="mDate"></label>
          </div>
          <div class="row">
            <button type="button" class="btn" id="calcBMR">Calc BMR/TDEE</button>
            <button type="button" class="btn" id="estimateBFScale">Estimate BF% (Scale-Assisted)</button>
            <button type="button" class="btn" id="estimateBF">Estimate BF% (Anthropometric)</button>
            <div class="spacer"></div>
            <button type="button" class="btn primary" id="saveMetrics">Save Entry</button>
          </div>
          <div id="bmrBox" class="muted"></div>
          <div id="bfBox" class="muted" style="margin-top:.5rem"></div>
        </div>
      </form>

      <section class="card">
        <header class="card-head"><h3>Metrics History</h3></header>
        <div class="card-body" id="metricsList"></div>
      </section>
    </section>

    <!-- CALORIES -->
    <section id="calories" class="panel">
      <form id="calForm" class="card">
        <header class="card-head">
          <h2>Calories</h2>
          <div class="row">
            <label>Daily Calories <input type="number" id="caloriesInput" placeholder="e.g., 2200"></label>
            <label>Activity Level
              <select id="activityLevel">
                <option value="sedentary">Sedentary</option>
                <option value="light">Lightly Active</option>
                <option value="moderate">Moderately Active</option>
                <option value="very">Very Active</option>
                <option value="athlete">Athlete</option>
              </select>
            </label>
            <label>Goal
              <select id="goal">
                <option value="loss">Lose Weight</option>
                <option value="maintain">Maintain</option>
                <option value="gain">Gain Weight</option>
              </select>
            </label>
          </div>
        </header>
        <div class="card-body">
          <div id="projectionBox" class="muted">Enter height/weight/age/sex in Settings for better estimates.</div>
          <button type="button" class="btn primary" id="estimateWeight">Estimate Weight Trend</button>
          <div style="margin-top:.75rem">
            <canvas id="chartProj"></canvas>
          </div>
        </div>
      </form>
    </section>

    <!-- COACH (Phase 2) -->
    <section id="coach" class="panel">
      <section class="card">
        <header class="card-head"><h2>Generate Plan</h2></header>
        <div class="card-body">
          <div class="row">
            <label>Goal
              <select id="coachGoal">
                <option value="loss">Weight loss</option>
                <option value="strength">Strength</option>
                <option value="general">General fitness</option>
              </select>
            </label>
            <label>Days / week <input type="number" id="coachDays" min="2" max="7" value="4"></label>
            <label>Equipment
              <select id="coachEquip">
                <option value="barbell">Barbell + Rack</option>
                <option value="dumbbells">Dumbbells + Bench</option>
                <option value="minimal">Minimal (BW + bands)</option>
              </select>
            </label>
          </div>
          <div class="row">
            <button class="btn" id="genPlan">Generate Week</button>
            <button class="btn" id="loadToday">Load Today‚Äôs Plan</button>
          </div>
          <div id="planOut" class="muted" style="margin-top:.5rem"></div>
        </div>
      </section>

      <section class="card">
        <header class="card-head"><h3>Muscle Readiness</h3><small class="muted">Fresh vs. fatigued based on your recent training.</small></header>
        <div class="card-body">
          <div id="readinessLegend" class="row"></div>
          <svg id="readiness" viewBox="0 0 300 140" class="readiness"></svg>
        </div>
      </section>
    </section>

    <!-- GOALS -->
    <section id="goals" class="panel">
      <form id="goalsForm" class="card">
        <header class="card-head"><h2>Goal Setting</h2></header>
        <div class="card-body grid2">
          <label>Body Weight Goal (lb) <input type="number" step="0.1" id="gWeight"></label>
          <label>Target Date <input type="date" id="gDate"></label>
          <label>Lift Goal: Exercise <input type="text" id="gLiftName" placeholder="e.g., Bench Press"></label>
          <label>Lift Goal: 1RM (lb) <input type="number" step="1" id="gLift1RM"></label>
        </div>
        <div class="card-body row">
          <button type="button" class="btn primary" id="saveGoals">Save Goals</button>
        </div>
      </form>

      <section class="card">
        <header class="card-head"><h3>Progress</h3></header>
        <div class="card-body" id="goalsProgress"></div>
      </section>
    </section>

    <!-- COMMUNITY -->
    <section id="community" class="panel">
      <section class="card">
        <header class="card-head"><h2>Social (Opt-in)</h2></header>
        <div class="card-body grid2">
          <label>Public Name <input type="text" id="cName" placeholder="e.g., Alex L."></label>
          <label>Opt-in Feed
            <select id="cOptIn"><option value="off">Off</option><option value="on">On</option></select>
          </label>
          <div class="row">
            <button class="btn" id="cShare">Copy Share Code</button>
            <input id="cImportText" placeholder="Paste friend code here">
            <button class="btn" id="cImport">Import</button>
          </div>
        </div>
      </section>
      <section class="card">
        <header class="card-head"><h3>Community Feed</h3></header>
        <div class="card-body" id="feed"></div>
      </section>
    </section>

    <!-- TEMPLATES + DEMOS -->
    <section id="templates" class="panel">
      <section class="card">
        <header class="card-head">
          <h2>Workout Templates</h2>
          <div class="row">
            <button class="btn" data-template="fullbody">Full Body (Beginner)</button>
            <button class="btn" data-template="ppl">Push / Pull / Legs</button>
            <button class="btn" data-template="fives">5x5</button>
            <button class="btn" data-template="phul">PHUL</button>
          </div>
        </header>
        <div class="card-body">
          <p>Select a template to copy into your workout form. You can edit everything before saving.</p>
        </div>
      </section>

      <section class="card">
        <header class="card-head"><h3>Exercise Demo Library</h3></header>
        <div class="card-body demos" id="demoLibrary"></div>
      </section>
    </section>
  </main>

  <dialog id="demoModal">
    <div class="modal">
      <header class="row">
        <h3 id="demoTitle">Exercise Demo</h3>
        <button id="closeDemo" class="btn">Close</button>
      </header>
      <div id="demoContent"></div>
    </div>
  </dialog>

  <footer class="foot">
    <small>¬© <span id="year"></span> LiftLog ‚Äî Privacy-first fitness tracker.</small>
  </footer>
</body>
</html>
